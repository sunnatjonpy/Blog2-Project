{% extends 'base.html' %}

{% block content %}
<div class="reading-wrap container py-4">
  <!-- Reading progress -->
  <div id="read-progress"></div>

  <article class="article">
    <!-- Cover image -->
    {% if object.photo %}
    <figure class="article-cover">
      <img src="{{ object.photo.url }}" alt="{{ object.title }}">
    </figure>
    {% endif %}

    <!-- Title + meta -->
    <header class="article-head">
      <h1 class="title">{{ object.title }}</h1>
      <div class="meta">
        <p class="meta-pill">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" style="width:18; height:18;">
                <path d="M320 312C386.3 312 440 258.3 440 192C440 125.7 386.3 72 320 72C253.7 72 200 125.7 200 192C200 258.3 253.7 312 320 312zM290.3 368C191.8 368 112 447.8 112 546.3C112 562.7 125.3 576 141.7 576L498.3 576C514.7 576 528 562.7 528 546.3C528 447.8 448.2 368 349.7 368L290.3 368z"/>
            </svg>{{ object.author|title }}</p>
        <p class="meta-pill"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" style="width:18; height:18;">
                <path d="M224 64C206.3 64 192 78.3 192 96L192 128L160 128C124.7 128 96 156.7 96 192L96 240L544 240L544 192C544 156.7 515.3 128 480 128L448 128L448 96C448 78.3 433.7 64 416 64C398.3 64 384 78.3 384 96L384 128L256 128L256 96C256 78.3 241.7 64 224 64zM96 288L96 480C96 515.3 124.7 544 160 544L480 544C515.3 544 544 515.3 544 480L544 288L96 288z"/>
            </svg>{{ object.date }}</p>
      </div>
    </header>

    <!-- Body -->
    <div class="prose">
      {{ object.body|safe }}
    </div>

    <!-- Quick actions -->
    <div class="actions">
        <a class="btn btn-sm btn-outline-primary" href="{% url 'article_edit' object.pk %}">Tahrirlash</a>
        <a class="btn btn-sm btn-outline-danger" href="{% url 'article_delete' object.pk %}">O‘chirish</a>
        <a class="btn btn-sm btn-primary" href="{% url 'article_list' %}">Barcha postlar</a>
    </div>
  

    <!-- Share (oddiy) -->
    <div class="share">
      <span>Ulashish:</span>
      <a class="share-link" target="_blank"
         href="https://t.me/share/url?url={{ request.build_absolute_uri }}&text={{ object.title }}">Telegram</a>
    </div>
  </article>

  <!-- Comments -->
  <section class="comments card mt-4">
    <div class="card-header">Izohlar</div>
    {% if object.comments.all %}
      <ul class="list-group list-group-flush">
        {% for comment in object.comments.all %}
          <li class="list-group-item">
            <blockquote class="mb-0">
              <p class="mb-1">{{ comment }}</p>
              <footer class="text-muted">— {{ comment.author }}</footer>
            </blockquote>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="card-body text-muted">Hozircha izohlar yo‘q.</div>
    {% endif %}
  </section>
</div>

<!-- Tiny script for reading progress -->
<script>
  (function () {
    const bar = document.getElementById('read-progress');
    const art = document.querySelector('.article');
    function onScroll() {
      if (!art) return;
      const h = art.scrollHeight - window.innerHeight;
      const y = Math.max(0, Math.min(1, window.scrollY / (h || 1)));
      bar.style.transform = `scaleX(${y})`;
    }
    window.addEventListener('scroll', onScroll, { passive: true });
    onScroll();
  })();
</script>
{% endblock content %}
